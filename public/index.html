<!doctype html>
<html>
<head>
  <meta charset=utf-8>
  <title>Receipt Scanner</title>
  <link rel="shortcut icon" type="image/jpg" href="/favicon.png"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.5.0/semantic.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qr-scanner/1.4.2/qr-scanner.legacy.min.js"></script>
</head>
<body>
<div class="ui tabular menu">
  <a class="active item">Scanner</a>
</div>

<div id="app" class="ui centered grid">
  <div class="four wide column" style="height: 95vh;">
    <canvas id="canvas"></canvas>
  </div>
  <div class="eight wide column">
    <h2>Camera Image</h2>

    <video id="video"></video>
    <div id="output"></div>

    <div class="two ui buttons">
      <button class="ui blue labeled icon button" v-on:click="cameraStart">
        <i class="camera icon"></i>Start Camera
      </button>
      <button class="ui red labeled icon button" v-on:click="cameraStop">
        <i class="stop circle outline icon"></i>Stop Camera
      </button>
    </div>
  </div>
  <div class="four wide column"></div>
</div>

<script type="text/javascript">
const video = document.querySelector("#video");
const output = document.querySelector("#output");
let processed = "";
const qrScanner = new QrScanner(video, result => {
  if (result !== processed) {
    fetch("/api/qrcode", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(result) })
      .then(data => output.innerText = "Success: " + JSON.stringify(data))
      .catch(error => output.innerText = "Error: " + JSON.stringify(error));

    processed = result;
  }
});
qrScanner.start();
</script>
</body>  
